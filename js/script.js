// Top switches
function toggleSwitch() {
  function changePage(page) {
    setTimeout(function() {
        window.location.href = page;
    }, 300);
    }

  const element = document.querySelector(
    ".toggleCheckbox + .toggleContainer span:first-child"
  );
  const style = window.getComputedStyle(element);
  const color = style.getPropertyValue("color");

  // Set to Social if colour is orange
  if (color === "rgb(234, 80, 35)") {
    changePage('social.html');
  }

  // Set to Professional if color is white
  if (color === "rgb(0, 0, 0)") {
    changePage('index.html');
  }
}

// Blue arrow animation
document.addEventListener("DOMContentLoaded", function () { 
    if (window.location.pathname.endsWith("social.html") || window.location.pathname.endsWith("index.html")) {
        document.getElementById('blue-arrows').addEventListener('click', function() {
            const aboutSection = document.querySelector('.about');
            aboutSection.scrollIntoView({ behavior: 'smooth' });
        });
    }
});

// Fun Fact
document.addEventListener("DOMContentLoaded", function () {
    const funFactElement = document.querySelector('.fun-fact');

    function updateFunFact() {
        const randomIndex = Math.floor(Math.random() * funFacts.length);
        const randomFact = `Did you know? ${funFacts[randomIndex]}`;
        funFactElement.textContent = randomFact;
        localStorage.setItem("lastFunFactUpdate", Date.now());
        localStorage.setItem("lastFunFact", randomFact);
    }

    function showFunFact() {
        const lastFunFact = localStorage.getItem("lastFunFact");
        funFactElement.textContent = lastFunFact;
    }

    const lastFunFactUpdate = localStorage.getItem("lastFunFactUpdate");
    const lastFunFact = localStorage.getItem("lastFunFact");

    // 5 minutes
    var funFactThreshold =  5 * 60 * 1000;
    if (lastFunFact === null || Date.now() - parseInt(lastFunFactUpdate) > funFactThreshold) {
        updateFunFact();
    }
    
    showFunFact();    
});

// Weather API
function setWeatherContainer(cityName, temperature, conditionText, iconPath) {
    const weatherContainer = document.getElementById("weather-container");
    lowCapsConditionText = conditionText.toLowerCase();
    weatherContainer.innerHTML = `<div>Looks like you're visiting from ${cityName}! The local weather is ${temperature}Â°C and ${lowCapsConditionText}<img height="50px" src="${iconPath}" alt="${conditionText}"> </div>`;
}

document.addEventListener("DOMContentLoaded", function () {
    async function getLocationAndWeather() {
        if ("geolocation" in navigator) {
            navigator.geolocation.getCurrentPosition(async function(position) {
                const latitude = position.coords.latitude;
                const longitude = position.coords.longitude;

                const weatherapikey = `c839316b88fd4ecfad9104852241305`
                const weatherApiUrl = `https://api.weatherapi.com/v1/current.json?key=${weatherapikey}&q=${latitude},${longitude}&aqi=no`;
                const response = await fetch(weatherApiUrl);
                const data = await response.json();

                const cityName = data.location.name
                const temperature = data.current.temp_c;
                const conditionText = data.current.condition.text;
                const isDay = data.current.is_day === 1;
                const iconCode = data.current.condition.icon.split("/").pop();
                const iconPath = `images/weather/${isDay ? 'day' : 'night'}/${iconCode}`;

                localStorage.setItem("weatherData", JSON.stringify({ cityName, temperature, conditionText, iconPath }));

                setWeatherContainer(cityName, temperature, conditionText, iconPath);

                localStorage.setItem("lastWeatherUpdate", Date.now());
            });
        }
    }

    // Function to check if 30 min has passed
    function shouldUpdateWeather() {
        const lastWeatherUpdate = localStorage.getItem("lastWeatherUpdate");
        if (!lastWeatherUpdate) {
            return true;
        }
        
         // 30 mins
        const weatherThreshold = 30 * 60 * 1000;
        return Date.now() - lastWeatherUpdate > weatherThreshold;
    }

    if (shouldUpdateWeather()) {
        getLocationAndWeather();
    } else {
        const storedWeatherData = localStorage.getItem("weatherData");
        if (storedWeatherData) {
            const { cityName, temperature, conditionText, iconPath } = JSON.parse(storedWeatherData);
            setWeatherContainer(cityName, temperature, conditionText, iconPath);
        }
        else {
            getLocationAndWeather();
        }
    }
});


// Media page only
document.addEventListener("DOMContentLoaded", function () {
    if (window.location.pathname.endsWith("media.html")) {
        const images = document.querySelectorAll(".image-gallery img");
        const popupContainer = document.querySelector(".popup-container");
        const popupImage = document.querySelector(".popup-image");
        const popupDescription = document.querySelector(".popup-description");

        images.forEach(function (image) {
            image.addEventListener("click", function () {
            popupImage.src = this.src;
            popupDescription.innerText = this.alt;
            popupContainer.style.display = "block";
            });
        });

        const closePopup = document.querySelector(".close");
        closePopup.addEventListener("click", function () {
            popupContainer.style.display = "none";
        });

        popupContainer.addEventListener("click", function (event) {
            if (event.target === popupContainer) {
            popupContainer.style.display = "none";
            }
        });
    }
});

// Travel page
document.addEventListener('DOMContentLoaded', function() {
    if (window.location.pathname.endsWith("travel.html")) 
    {
        function displayName(name) {
            const flag = getFlagEmoji(name);
            document.getElementById('country-name').firstChild.data = flag + ' ' + name;
        }

        function undisplayName() {
            document.getElementById('country-name').firstChild.data = "Hover over a country";
        }

        function highlightCountry(country) {
            let replaced = country.replace(/ /g, ".");
            const paths = document.querySelectorAll('.' + replaced);
            paths.forEach(path => {
                path.style.fill = 'red';
            });
        }

        function unhighlightCountry(country) {
            let replaced = country.replace(/ /g, ".");
            const paths = document.querySelectorAll('.' + replaced);
            paths.forEach(path => {
                const trips = tripsData[country];
                let color = 'white';
                if (trips && trips.length > 0) {
                    const shade = Math.min(255, Math.max(0, Math.round(255 - trips.length * 32)));
                    color = `rgb(${shade}, ${shade}, ${shade})`;
                }
                path.style.fill = color;
            });
        }
        
        function getFlagEmoji(country) {
            return countryFlags[country] || '';
        }
        
        function displayInformation(country) {
            const trips = tripsData[country];
            const tripCardsContainer = document.querySelector('.trip-cards-container');
            tripCardsContainer.innerHTML = '';
        
            // For each trip within the country, create a new list item for each trip
            if (trips) {
                for (let i = 0; i < trips.length; i++) {
                    const trip = trips[i];
                    const tripCard = document.createElement('li');
                    tripCard.classList.add('trip-card');
                    let photosHtml = '';
                    for (let j = 0; j < trip.photos.length; j++) {
                        photosHtml += `<img src="${trip.photos[j]}" alt="Image description">`;
                    }
                    tripCard.innerHTML = `
                        <h4>#${trip.name} ${trip.date}</h4>
                        <p><strong>Cities: ${trip.cities}</strong></p>
                        <p>${trip.description}</p>
                        <div class="photos-container">${photosHtml}</div>
                    `;
                    tripCardsContainer.appendChild(tripCard);
                }
        
                document.querySelector('.country-name-selected').innerHTML = `${getFlagEmoji(trips[0].country)} ${trips[0]['country']}`;
                document.querySelector('.country-visit-number').innerHTML = `Visits: ${trips.length}`;
            } else {
                document.querySelector('.country-name-selected').innerHTML = `${getFlagEmoji(country)} ${country}`;
                document.querySelector('.country-visit-number').innerHTML = ` `;
                tripCardsContainer.innerHTML = `<li>I haven't travelled to ${country} yet!</li>`;
            }
        }

        // Shading countries by visiting frequency
        function shadeCountries() {
            const pathElements = document.querySelectorAll('path');
            pathElements.forEach(path => {
                const countryName = path.getAttribute('class');
                const trips = tripsData[countryName];
                let color = 'white';
                if (trips && trips.length > 0) {
                    const shade = Math.min(255, Math.max(0, Math.round(255 - trips.length * 32)));
                    color = `rgb(${shade}, ${shade}, ${shade})`;
                }
                path.style.fill = color;
            });
        }

        function promptToSelect() {
            const currentText = document.querySelector('.country-name-selected');
            if (currentText.innerHTML === "SELECT A COUNTRY") {
                currentText.classList.add('fade-in-out');
                currentText.style.color = "lightgray";
                currentText.style.textAlign = "center";
            } else {
                currentText.classList.remove('fade-in-out');
                currentText.style.color = "black";
                currentText.style.textAlign = "left";
            }
        }        
        
        // Initial running upon loading
        promptToSelect();
        shadeCountries();

        // Creating event listeners for every country
        const pathElements = document.querySelectorAll('path');

        pathElements.forEach(path => {
            const country = path.getAttribute('class');
            path.addEventListener('mouseover', () => {
                displayName(country);
                highlightCountry(country);
            });
            path.addEventListener('mouseout', () => {
                undisplayName();
                unhighlightCountry(country);
            });
            path.addEventListener('click', () => {
                displayInformation(country);
                promptToSelect();
            });
        });
    }
});

// Considered putting this information into another file, but it caused CORS issues. Most effective method was to just leave it here.
const countryFlags = {
    'Afghanistan': 'ð¦ð«',
    'Albania': 'ð¦ð±',
    'Algeria': 'ð©ð¿',
    'Andorra': 'ð¦ð©',
    'Angola': 'ð¦ð´',
    'Antigua & Barbuda': 'ð¦ð¬',
    'Argentina': 'ð¦ð·',
    'Armenia': 'ð¦ð²',
    'Australia': 'ð¦ðº',
    'Austria': 'ð¦ð¹',
    'Azerbaijan': 'ð¦ð¿',
    'Bahamas': 'ð§ð¸',
    'Bahrain': 'ð§ð­',
    'Bangladesh': 'ð§ð©',
    'Barbados': 'ð§ð§',
    'Belarus': 'ð§ð¾',
    'Belgium': 'ð§ðª',
    'Belize': 'ð§ð¿',
    'Benin': 'ð§ð¯',
    'Bhutan': 'ð§ð¹',
    'Bolivia': 'ð§ð´',
    'Bosnia & Herzegovina': 'ð§ð¦',
    'Botswana': 'ð§ð¼',
    'Brazil': 'ð§ð·',
    'Brunei': 'ð§ð³',
    'Bulgaria': 'ð§ð¬',
    'Burkina Faso': 'ð§ð«',
    'Burundi': 'ð§ð®',
    'Cabo Verde': 'ð¨ð»',
    'Cambodia': 'ð°ð­',
    'Cameroon': 'ð¨ð²',
    'Canada': 'ð¨ð¦',
    'Central African Republic': 'ð¨ð«',
    'Chad': 'ð¹ð©',
    'Chile': 'ð¨ð±',
    'China': 'ð¨ð³',
    'Colombia': 'ð¨ð´',
    'Comoros': 'ð°ð²',
    'Democratic Republic of the Congo': 'ð¨ð¬',
    'Costa Rica': 'ð¨ð·',
    'Croatia': 'ð­ð·',
    'Cuba': 'ð¨ðº',
    'Cyprus': 'ð¨ð¾',
    'Czech Republic': 'ð¨ð¿',
    'Denmark': 'ð©ð°',
    'Djibouti': 'ð©ð¯',
    'Dominica': 'ð©ð²',
    'Dominican Republic': 'ð©ð´',
    'Ecuador': 'ðªð¨',
    'Egypt': 'ðªð¬',
    'El Salvador': 'ð¸ð»',
    'Equatorial Guinea': 'ð¬ð¶',
    'Eritrea': 'ðªð·',
    'Estonia': 'ðªðª',
    'Eswatini': 'ð¸ð¿',
    'Ethiopia': 'ðªð¹',
    'Falkland Islands': 'ð«ð°',
    'Fiji': 'ð«ð¯',
    'Finland': 'ð«ð®',
    'France': 'ð«ð·',
    'Gabon': 'ð¬ð¦',
    'Gambia': 'ð¬ð²',
    'Georgia': 'ð¬ðª',
    'Germany': 'ð©ðª',
    'Ghana': 'ð¬ð­',
    'Greece': 'ð¬ð·',
    'Greenland': 'ð¬ð±',
    'Grenada': 'ð¬ð©',
    'Guatemala': 'ð¬ð¹',
    'Guinea': 'ð¬ð³',
    'Guinea-Bissau': 'ð¬ð¼',
    'French Guiana': 'ð¬ð¾',
    'Haiti': 'ð­ð¹',
    'Honduras': 'ð­ð³',
    'Hungary': 'ð­ðº',
    'Iceland': 'ð®ð¸',
    'India': 'ð®ð³',
    'Indonesia': 'ð®ð©',
    'Iran': 'ð®ð·',
    'Iraq': 'ð®ð¶',
    'Ireland': 'ð®ðª',
    'Israel': 'ð®ð±',
    'Italy': 'ð®ð¹',
    'Jamaica': 'ð¯ð²',
    'Japan': 'ð¯ðµ',
    'Jordan': 'ð¯ð´',
    'Kazakhstan': 'ð°ð¿',
    'Kenya': 'ð°ðª',
    'Kiribati': 'ð°ð®',
    'Dem Rep Korea': 'ð°ðµ',
    'Republic of Korea': 'ð°ð·',
    'Kosovo': 'ð½ð°',
    'Kuwait': 'ð°ð¼',
    'Kyrgyzstan': 'ð°ð¬',
    'Lao PDR': 'ð±ð¦',
    'Latvia': 'ð±ð»',
    'Lebanon': 'ð±ð§',
    'Lesotho': 'ð±ð¸',
    'Liberia': 'ð±ð·',
    'Libya': 'ð±ð¾',
    'Liechtenstein': 'ð±ð®',
    'Lithuania': 'ð±ð¹',
    'Luxembourg': 'ð±ðº',
    'Madagascar': 'ð²ð¬',
    'Malawi': 'ð²ð¼',
    'Malaysia': 'ð²ð¾',
    'Maldives': 'ð²ð»',
    'Mali': 'ð²ð±',
    'Malta': 'ð²ð¹',
    'Marshall Islands': 'ð²ð­',
    'Mauritania': 'ð²ð·',
    'Mauritius': 'ð²ðº',
    'Mexico': 'ð²ð½',
    'Micronesia': 'ð«ð²',
    'Moldova': 'ð²ð©',
    'Monaco': 'ð²ð¨',
    'Mongolia': 'ð²ð³',
    'Montenegro': 'ð²ðª',
    'Morocco': 'ð²ð¦',
    'Mozambique': 'ð²ð¿',
    'Myanmar': 'ð²ð²',
    'Namibia': 'ð³ð¦',
    'Nauru': 'ð³ð·',
    'Nepal': 'ð³ðµ',
    'Netherlands': 'ð³ð±',
    'New Zealand': 'ð³ð¿',
    'Nicaragua': 'ð³ð®',
    'Niger': 'ð³ðª',
    'Nigeria': 'ð³ð¬',
    'North Macedonia': 'ð²ð°',
    'Norway': 'ð³ð´',
    'Oman': 'ð´ð²',
    'Pakistan': 'ðµð°',
    'Palau': 'ðµð¼',
    'Palestine': 'ðµð¸',
    'Panama': 'ðµð¦',
    'Papua New Guinea': 'ðµð¬',
    'Paraguay': 'ðµð¾',
    'Peru': 'ðµðª',
    'Philippines': 'ðµð­',
    'Poland': 'ðµð±',
    'Portugal': 'ðµð¹',
    'Qatar': 'ð¶ð¦',
    'Romania': 'ð·ð´',
    'Russian Federation': 'ð·ðº',
    'Rwanda': 'ð·ð¼',
    'Saint Kitts & Nevis': 'ð°ð³',
    'Saint Lucia': 'ð±ð¨',
    'Saint Vincent & Grenadines': 'ð»ð¨',
    'Samoa': 'ð¼ð¸',
    'San Marino': 'ð¸ð²',
    'Sao Tome & Principe': 'ð¸ð¹',
    'Saudi Arabia': 'ð¸ð¦',
    'Senegal': 'ð¸ð³',
    'Serbia': 'ð·ð¸',
    'Seychelles': 'ð¸ð¨',
    'Sierra Leone': 'ð¸ð±',
    'Singapore': 'ð¸ð¬',
    'Slovakia': 'ð¸ð°',
    'Slovenia': 'ð¸ð®',
    'Solomon Islands': 'ð¸ð§',
    'Somalia': 'ð¸ð´',
    'South Africa': 'ð¿ð¦',
    'South Sudan': 'ð¸ð¸',
    'Spain': 'ðªð¸',
    'Sri Lanka': 'ð±ð°',
    'Sudan': 'ð¸ð©',
    'Suriname': 'ð¸ð·',
    'Sweden': 'ð¸ðª',
    'Switzerland': 'ð¨ð­',
    'Syria': 'ð¸ð¾',
    'Taiwan': 'ð¹ð¼',
    'Tajikistan': 'ð¹ð¯',
    'Tanzania': 'ð¹ð¿',
    'Thailand': 'ð¹ð­',
    'Timor-Leste': 'ð¹ð±',
    'Togo': 'ð¹ð¬',
    'Tonga': 'ð¹ð´',
    'Trinidad & Tobago': 'ð¹ð¹',
    'Tunisia': 'ð¹ð³',
    'Turkey': 'ð¹ð·',
    'Turkmenistan': 'ð¹ð²',
    'Tuvalu': 'ð¹ð»',
    'Uganda': 'ðºð¬',
    'Ukraine': 'ðºð¦',
    'United Arab Emirates': 'ð¦ðª',
    'United Kingdom': 'ð¬ð§',
    'United States': 'ðºð¸',
    'Uruguay': 'ðºð¾',
    'Uzbekistan': 'ðºð¿',
    'Vanuatu': 'ð»ðº',
    'Vatican City': 'ð»ð¦',
    'Venezuela': 'ð»ðª',
    'Vietnam': 'ð»ð³',
    'Yemen': 'ð¾ðª',
    'Zambia': 'ð¿ð²',
    'Zimbabwe': 'ð¿ð¼',
};

const funFacts = [
    "These fun facts are updated every 5 minutes",
    "I've visited over 10 countries in the past year.",
    "I'm learning to play the guitar.",
    "The colour scheme for this website was originally based off of Star War's Republic Commandos.",
  ];

const tripsData = {
    "China": [
        {
            "country": "China",
            "name": "1",
            "date": "November 2023",
            "cities": "Shanghai, Guangzhou",
            "description": "Went on a trip with my mum for two weeks to visit family and do some light sight seeing. It had been nearly 10 years since I had been to China. Some places to went to included Shanghai, Anhui (hometown), Guangzhou, Hangzhou, and Huangshan. We climbed up Huangshan, which was one of the highlights of the trip. It took around 6 hours, and it was really cold once we got up to the top!",
            "photos": ["images/media/mountains.jpg", "images/media/hanfu.jpg"]
        },
        {
            "country": "China",
            "name": "2",
            "date": "August 2015",
            "cities": "Beijing, Anhui",
            "description": "Visited my family, and saw the Great Wall! We walked along it for a bit, before getting tired and returning.",
            "photos": []
        }
    ],
    "Italy": [
        {
            "country": "Italy",
            "name": "1",
            "date": "July 2023",
            "cities": "Venice, Florence, Cinque Terre, Milan, Rome",
            "description": "We went to Italy after my short exchange at LSE in London prior. We took trains the entire way, and stayed in each place for only a couple days. We did 2 nights in Venice, 1 night in Florence, 3 nights in Cinque Terre (rest point in the trip!) 1 night in Milan, and 3 nights in Rome. It was peak tourist season, so it was incredibly busy, and there was also a heatwave at the same time. We had to wake up really early and do most of the touring very early in the morning! In Cinque Terre, we stayed in Riomaggiore, at the top of the hill (600 steps to where we were staying or - according to Google Maps - a 6 minute walk: if you could fly'). ",
            "photos": ["images/media/venice.jpg"]
        }
    ],
    "Peru": [
        {
            "country": "Peru",
            "name": "1",
            "date": "December 2019",
            "cities": "Cusco, Lima, Arequipa",
            "description": "Went to Peru with Antipodeans during high school - fantastic experience! We went for three weeks and did a three day Lares Trek hike. It was stunning, and very different to any other country I had been to before. The people and the culture was really cool to be immersed in.",
            "photos": []
        }
    ],
    "United Kingdom": [
        {
            "country": "United Kingdom",
            "name": "1",
            "date": "June 2010",
            "cities": "London, Stonehenge",
            "description": "Travelled with Europe with my family. In London, visited Big Ben, and the Cathedral. I was quite young so I don't remember too much of it.",
            "photos": []
        },
        {
            "country": "United Kingdom",
            "name": "2",
            "date": "June-July 2023",
            "cities": "London, Windsor",
            "description": "Attended London School of Economics (LSE) for a short exchange during university. Was a fun trip with friends. I visited all the main attractions, and also got to do a weekend trip out to Amsterdam and Windsor Castle. There was also a mid-exchange boat party on the Thames River hosted by LSE, which was a lot of fun. Other highlights included watching Phantom of the Opera at the King's Theatre.",
            "photos": []
        }
    ]
};
